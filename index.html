<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì•„ì´í†¡ (iTalk) - AI ê¸°ë°˜ AAC ì†”ë£¨ì…˜</title>
    
    <!-- CDNs: React, Babel, Tailwind, Lucide -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; overflow-x: hidden; user-select: none; touch-action: none; }
        input[type=range] { height: 4px; background: #e5e7eb; border-radius: 2px; outline: none; }
        .animate-fade-in { animation: fadeIn 0.7s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ê°„ë‹¨í•œ Lucide Icon ì»´í¬ë„ŒíŠ¸ (CDN í™˜ê²½ìš©) ---
        const Icon = ({ name, className }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            
            // í—¤ë“œ íŠ¸ë˜í‚¹ ìƒíƒœ
            const videoRef = useRef(null);
            const [isTracking, setIsTracking] = useState(false);
            const [loadingModel, setLoadingModel] = useState(false);
            const [sensitivity, setSensitivity] = useState({ x: 2.5, y: 2.5 });
            const [smoothing, setSmoothing] = useState(0.12);
            const [cursorPos, setCursorPos] = useState({ x: 0, y: 0 });
            const [isMouthOpen, setIsMouthOpen] = useState(false);
            
            const targetPos = useRef({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
            const currentPos = useRef({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
            const noseOffset = useRef({ x: 0, y: 0 });
            const isCalibrated = useRef(false);

            // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ìœ í‹¸ë¦¬í‹°
            const loadScript = (src) => {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            };

            const initTracking = async () => {
                setLoadingModel(true);
                try {
                    await loadScript("https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js");
                    await loadScript("https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js");
                    
                    const faceMesh = new window.FaceMesh({
                        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
                    });

                    faceMesh.setOptions({
                        maxNumFaces: 1,
                        refineLandmarks: true,
                        minDetectionConfidence: 0.5,
                        minTrackingConfidence: 0.5
                    });

                    faceMesh.onResults(onResults);

                    const camera = new window.Camera(videoRef.current, {
                        onFrame: async () => {
                            await faceMesh.send({ image: videoRef.current });
                        },
                        width: 640,
                        height: 480
                    });
                    
                    await camera.start();
                    setIsTracking(true);
                    setLoadingModel(false);
                } catch (error) {
                    console.error("Tracking Error:", error);
                    alert("ì¹´ë©”ë¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    setLoadingModel(false);
                }
            };

            function onResults(results) {
                if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                    const landmarks = results.multiFaceLandmarks[0];
                    const nose = landmarks[4];
                    let nx = (1 - nose.x) - 0.5;
                    let ny = nose.y - 0.5;

                    if (!isCalibrated.current) {
                        noseOffset.current = { x: nx, y: ny };
                        isCalibrated.current = true;
                    }

                    nx -= noseOffset.current.x;
                    ny -= noseOffset.current.y;

                    const screenCX = window.innerWidth / 2;
                    const screenCY = window.innerHeight / 2;

                    targetPos.current = {
                        x: Math.max(0, Math.min(window.innerWidth, screenCX + (nx * window.innerWidth * sensitivity.x))),
                        y: Math.max(0, Math.min(window.innerHeight, screenCY + (ny * window.innerHeight * sensitivity.y)))
                    };

                    const upperLip = landmarks[13];
                    const lowerLip = landmarks[14];
                    const mouthOpenDist = Math.abs(upperLip.y - lowerLip.y);
                    
                    if (mouthOpenDist > 0.05) {
                        setIsMouthOpen(true);
                        handleAutoClick();
                    } else {
                        setIsMouthOpen(false);
                    }
                }
            }

            useEffect(() => {
                let animationFrame;
                const update = () => {
                    currentPos.current.x += (targetPos.current.x - currentPos.current.x) * smoothing;
                    currentPos.current.y += (targetPos.current.y - currentPos.current.y) * smoothing;
                    setCursorPos({ x: currentPos.current.x, y: currentPos.current.y });
                    animationFrame = requestAnimationFrame(update);
                };
                update();
                return () => cancelAnimationFrame(animationFrame);
            }, [smoothing]);

            const lastClickTime = useRef(0);
            const handleAutoClick = () => {
                const now = Date.now();
                if (now - lastClickTime.current > 1200) {
                    lastClickTime.current = now;
                    const elem = document.elementFromPoint(currentPos.current.x, currentPos.current.y);
                    if (elem && elem.closest('button')) {
                        elem.closest('button').click();
                    }
                }
            };

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const ut = new SpeechSynthesisUtterance(text);
                    ut.lang = 'ko-KR';
                    window.speechSynthesis.speak(ut);
                }
            };

            return (
                <div className="min-h-screen">
                    {/* Navigation */}
                    <nav className="sticky top-0 z-[100] bg-white/80 backdrop-blur-md border-b border-slate-200">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setActiveTab('home')}>
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white">
                                    <Icon name="volume-2" className="w-5 h-5" />
                                </div>
                                <span className="text-xl font-bold tracking-tight">ì•„ì´í†¡</span>
                            </div>
                            
                            <div className="hidden md:flex space-x-8 font-medium text-sm">
                                <button onClick={() => setActiveTab('home')} className={activeTab === 'home' ? 'text-indigo-600' : 'text-slate-500'}>í™ˆ</button>
                                <button onClick={() => setActiveTab('about')} className={activeTab === 'about' ? 'text-indigo-600' : 'text-slate-500'}>íšŒì‚¬ ì†Œê°œ</button>
                                <button onClick={() => setActiveTab('program')} className={activeTab === 'program' ? 'text-indigo-600' : 'text-slate-500'}>ì†”ë£¨ì…˜ ì²´í—˜</button>
                                <button onClick={() => setActiveTab('custom')} className={activeTab === 'custom' ? 'text-indigo-600' : 'text-slate-500'}>ê°œë³„í™” ì‹ ì²­</button>
                            </div>
                        </div>
                    </nav>

                    <main className="animate-fade-in">
                        {activeTab === 'program' && isTracking && (
                            <div className={`fixed pointer-events-none z-[9999] rounded-full border-2 border-white shadow-lg transition-all duration-100 ${isMouthOpen ? 'w-10 h-10 bg-emerald-500 scale-125' : 'w-6 h-6 bg-rose-500'}`}
                                 style={{ left: cursorPos.x, top: cursorPos.y, transform: 'translate(-50%, -50%)' }} />
                        )}

                        {activeTab === 'home' && (
                            <section className="pt-20 pb-32 max-w-7xl mx-auto px-4 grid lg:grid-cols-2 gap-12 items-center">
                                <div>
                                    <h1 className="text-5xl lg:text-7xl font-black mb-8 leading-tight">
                                        ê³ ê°œ ì§“ í•˜ë‚˜ë¡œ<br /><span className="text-indigo-600">ì„¸ìƒê³¼ ëŒ€í™”í•˜ì„¸ìš”.</span>
                                    </h1>
                                    <p className="text-lg text-slate-600 mb-10 leading-relaxed">ì•„ì´í†¡ì€ AI í—¤ë“œ íŠ¸ë˜í‚¹ ê¸°ìˆ ì„ í™œìš©í•œ í˜ì‹ ì ì¸ ë³´ì™„ëŒ€ì²´ì˜ì‚¬ì†Œí†µ(AAC) ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                                    <div className="flex gap-4">
                                        <button onClick={() => setActiveTab('program')} className="px-8 py-4 bg-indigo-600 text-white font-bold rounded-2xl shadow-xl shadow-indigo-100">ì²´í—˜í•˜ê¸°</button>
                                        <button onClick={() => setActiveTab('custom')} className="px-8 py-4 bg-white border-2 border-slate-200 font-bold rounded-2xl">ìƒë‹´ì‹ ì²­</button>
                                    </div>
                                </div>
                                <div className="bg-indigo-900 rounded-3xl aspect-video overflow-hidden shadow-2xl relative flex items-center justify-center">
                                    <div className="absolute inset-0 opacity-40 bg-[url('https://images.unsplash.com/photo-1573497620053-ea5310f94f17')] bg-cover bg-center"></div>
                                    <Icon name="play" className="w-16 h-16 text-white" />
                                </div>
                            </section>
                        )}

                        {activeTab === 'program' && (
                            <section className="py-20 flex flex-col items-center">
                                {!isTracking ? (
                                    <div className="bg-white p-12 rounded-3xl shadow-xl text-center max-w-md">
                                        <h3 className="text-2xl font-bold mb-4">ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                                        <button onClick={initTracking} disabled={loadingModel} className="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl">
                                            {loadingModel ? "ë¡œë”© ì¤‘..." : "ì²´í—˜ ì‹œì‘í•˜ê¸°"}
                                        </button>
                                    </div>
                                ) : (
                                    <div className="w-full max-w-4xl px-4 flex flex-col gap-8 pb-40">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                            <button onClick={() => speak("ë„¤")} className="h-64 rounded-[2rem] bg-emerald-500 text-white text-7xl font-black shadow-xl border-b-8 border-emerald-700 active:border-b-0 active:translate-y-2">â­• ë„¤</button>
                                            <button onClick={() => speak("ì•„ë‹ˆì˜¤")} className="h-64 rounded-[2rem] bg-rose-500 text-white text-7xl font-black shadow-xl border-b-8 border-rose-700 active:border-b-0 active:translate-y-2">âŒ ì•„ë‹ˆì˜¤</button>
                                        </div>
                                        {/* Controls */}
                                        <div className="fixed bottom-0 inset-x-0 bg-white shadow-2xl p-6 flex flex-col md:flex-row items-center gap-6 z-50">
                                            <video ref={videoRef} className="w-32 h-24 bg-black rounded-lg scale-x-[-1] object-cover" playsInline />
                                            <div className="flex-1 grid grid-cols-3 gap-4 w-full text-[10px] font-bold">
                                                <div>ìˆ˜í‰ <input type="range" min="1" max="5" step="0.1" value={sensitivity.x} onChange={e=>setSensitivity({...sensitivity, x: e.target.value})} className="w-full"/></div>
                                                <div>ìˆ˜ì§ <input type="range" min="1" max="5" step="0.1" value={sensitivity.y} onChange={e=>setSensitivity({...sensitivity, y: e.target.value})} className="w-full"/></div>
                                                <div>ì†ë„ <input type="range" min="0.01" max="0.3" step="0.01" value={smoothing} onChange={e=>setSmoothing(e.target.value)} className="w-full"/></div>
                                            </div>
                                            <button onClick={()=>isCalibrated.current=false} className="px-6 py-3 bg-slate-800 text-white rounded-xl font-bold">ğŸ¯ ì¬ì„¤ì •</button>
                                        </div>
                                    </div>
                                )}
                            </section>
                        )}
                        
                        {activeTab === 'about' && (
                            <section className="py-20 max-w-4xl mx-auto px-4 text-center">
                                <h3 className="text-4xl font-bold mb-8">ì•„ì´í†¡ì˜ ë¯¸ì…˜</h3>
                                <p className="text-xl text-slate-600 leading-relaxed">ì–¸ì–´ê°€ ê¶Œë¦¬ê°€ ë˜ëŠ” ì„¸ìƒì„ ê¿ˆê¿‰ë‹ˆë‹¤. ëˆ„êµ¬ë‚˜ ìì‹ ì˜ ìƒê°ê³¼ ë§ˆìŒì„ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ ê°€ì¥ ë”°ëœ»í•œ ê¸°ìˆ ì„ ì—°êµ¬í•©ë‹ˆë‹¤.</p>
                            </section>
                        )}

                        {activeTab === 'custom' && (
                            <section className="py-20 max-w-xl mx-auto px-4">
                                <div className="bg-white p-10 rounded-3xl shadow-2xl border border-slate-100">
                                    <h4 className="text-2xl font-bold mb-8">ë§ì¶¤ ê¸°ëŠ¥ ìƒë‹´</h4>
                                    <form className="space-y-6" onSubmit={e=>e.preventDefault()}>
                                        <input type="text" placeholder="ì„±í•¨" className="w-full p-4 bg-slate-50 border rounded-xl" />
                                        <input type="tel" placeholder="ì—°ë½ì²˜" className="w-full p-4 bg-slate-50 border rounded-xl" />
                                        <select className="w-full p-4 bg-slate-50 border rounded-xl">
                                            <option>ì‹œì„  ì¶”ì  ì»¤ìŠ¤í…€</option>
                                            <option>ê°œì¸ ë³´ì´ìŠ¤ ë³µì œ</option>
                                            <option>ì œìŠ¤ì²˜ ì¸ì‹ ì¶”ê°€</option>
                                        </select>
                                        <button className="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl">ì‹ ì²­í•˜ê¸°</button>
                                    </form>
                                </div>
                            </section>
                        )}
                    </main>

                    <footer className="bg-slate-900 text-slate-400 py-12 px-4 text-center mt-20">
                        <p className="mb-4 text-white font-bold">ì•„ì´í†¡ (iTalk)</p>
                        <p className="text-sm">Â© 2024 ì•„ì´í†¡ Inc. All rights reserved.</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
